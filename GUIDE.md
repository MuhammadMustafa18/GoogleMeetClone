# How to Recreate: PeerJS Video Calling App

This guide explains how to build a minimal, high-performance P2P video conferencing tool using **Next.js**, **Tailwind CSS**, and **PeerJS**.

## 1. Prerequisites

Ensure you have a Next.js project set up with Tailwind CSS.

```bash
npx create-next-app@latest my-video-app --tailwind --typescript
cd my-video-app
npm install peerjs
```

## 2. The Core Logic (PeerJS)

The application uses **PeerJS** for simple WebRTC P2P connections. The logic resides in a `useEffect` to ensure it only runs on the client.

### Key Concepts:
- **Peer Instance**: Initializes the connection to the PeerJS signaling server.
- **Peer ID**: A unique identifier for each user (automatically generated by default).
- **MediaStream**: Captured via `navigator.mediaDevices.getUserMedia`.
- **Answering & Calling**:
    - `peer.on('call', ...)`: Handles incoming calls.
    - `peerInstance.current.call(id, stream)`: Initiates an outgoing call.

## 3. Implementation Steps (`page.tsx`)

### Step A: Setup State and Refs
We use `useRef` for elements that shouldn't trigger re-renders (like video streams and the Peer instance) and `useState` for UI states.

```tsx
const localVideoRef = useRef<HTMLVideoElement>(null);
const remoteVideoRef = useRef<HTMLVideoElement>(null);
const [isCalling, setIsCalling] = useState(false);
const [peerId, setPeerId] = useState('');
```

### Step B: Initialize PeerJS
Initialize Peer inside `useEffect` with a dynamic import to avoid SSR issues.

```tsx
useEffect(() => {
  import('peerjs').then(({ default: Peer }) => {
    const peer = new Peer();
    peer.on('open', (id) => setPeerId(id));
    peer.on('call', (call) => {
      // Logic to answer call with local stream
    });
    peerInstance.current = peer;
  });
}, []);
```

### Step C: Handle Media
Request access to the camera and microphone before calling or answering.

```tsx
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
  .then((stream) => {
    localVideoRef.current!.srcObject = stream;
    // proceed with call...
  });
```

## 4. UI Design Patterns

To recreate the premium look used in this project:

- **Main Screen**: Use `absolute inset-0` with `object-cover` for the remote video to make it full-screen.
- **PiP (Picture-in-Picture)**: Use `absolute bottom-8 right-8` with a fixed width/height for the local video.
- **Glassmorphism**: Use `bg-black/60` combined with `backdrop-blur-2xl` and `border-white/10` for overlays.
- **Responsive Layout**: Adjust the PiP size based on screen width using Tailwind's `sm:` prefix.

## 5. Running the App

1. Start your dev server: `npm run dev`
2. Open `http://localhost:3000` in **two different browser tabs**.
3. Copy the ID from Tab 1 and paste it into the input of Tab 2.
4. Click **Start Session**.

> [!TIP]
> peerjs.com provides a free signaling server by default, so you don't need to host your own for basic testing!
